<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1-22 ÈªûÂêç</title>
    <style>
        :root {
            /* È°èËâ≤ËÆäÈáè */
            --common-color: rgba(255, 255, 255, 0.2);
            --uncommon-color: rgba(50, 205, 50, 0.3);
            --rare-color: rgba(51, 153, 255, 0.3);
            --epic-color: rgba(153, 102, 255, 0.3);
            --legendary-color: rgba(255, 215, 0, 0.3);
            
            /* ÂãïÁï´ÊôÇÈï∑ */
            --animation-fast: 0.3s;
            --animation-normal: 0.5s;
            --animation-slow: 1s;
            
            /* GIFÈ°ØÁ§∫Â∞∫ÂØ∏ */
            --gif-width: 400px;
            --gif-height: 300px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
            text-align: center;
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 90%;
            max-width: 600px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 2.5rem;
            letter-spacing: 2px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        #drawButton {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--animation-normal) ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            margin: 20px 0;
            width: 80%;
            max-width: 300px;
        }

        #drawButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            letter-spacing: 1px;
        }

        #drawButton:focus {
            outline: 2px solid #ffffff;
            outline-offset: 2px;
        }

        #drawButton:disabled {
            background: linear-gradient(45deg, #b8b8b8, #888888);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            letter-spacing: normal;
        }

        #resultArea {
            margin-top: 20px;
            font-size: 1.1rem;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #currentNumber {
            font-size: 8rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all var(--animation-slow) cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1;
        }

        #drawnNumbers {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            min-height: 80px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        #drawnNumbers span {
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all var(--animation-normal) ease;
            border: 1px solid transparent;
            position: relative;
        }

        #drawnNumbers span:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        #statusMessage {
            font-style: italic;
            color: #f0f0f0;
            margin-top: 10px;
            font-size: 1rem;
            min-height: 20px;
        }

        /* Á®ÄÊúâÂ∫¶Ê®£Âºè */
        .common {
            background-color: var(--common-color);
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }

        .uncommon {
            background-color: var(--uncommon-color);
            border-color: rgba(50, 205, 50, 0.5);
            color: #90ee90;
            font-weight: 600;
        }

        .rare {
            background-color: var(--rare-color);
            border-color: rgba(51, 153, 255, 0.5);
            color: #add8e6;
            font-weight: bold;
        }

        .epic {
            background-color: var(--epic-color);
            border-color: rgba(153, 102, 255, 0.5);
            color: #d8bfd8;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(153, 102, 255, 0.5);
        }

        .legendary {
            background-color: var(--legendary-color);
            border-color: rgba(255, 215, 0, 0.5);
            color: #f0e68c;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            animation: legendaryPulse 2s infinite;
        }

        @keyframes legendaryPulse {
            0% {
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
            100% {
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            }
        }

        /* Á≤íÂ≠êÊïàÊûúÂÆπÂô® */
        #particleContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0;
        }

        /* Á®ÄÊúâÂ∫¶Ê®ôÁ±§ */
        .rarity-tag {
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Êï∏Â≠óÂá∫ÁèæÂãïÁï´ */
        @keyframes numberAppear {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            70% {
                transform: scale(1.3);
                opacity: 1;
            }
            100% {
                transform: scale(1);
            }
        }

        .number-appear {
            animation: numberAppear 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* Á®ÄÊúâÂ∫¶ÊèêÁ§∫ */
        #rarityMessage {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
            height: 2rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* ÈáçÁΩÆÊåâÈàï */
        #resetButton {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all var(--animation-normal) ease;
            margin-top: 10px;
        }

        #resetButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }

        /* GIFÁâπÊïàÂÆπÂô® */
        .gif-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .gif-overlay.active {
            display: flex;
        }

        .gif-container {
            width: var(--gif-width);
            height: var(--gif-height);
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .gif-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 5px;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            :root {
                --gif-width: 350px;
                --gif-height: 262px;
            }
            
            body {
                padding: 15px;
            }
            
            .container {
                padding: 25px 30px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            #currentNumber {
                font-size: 6rem;
            }
            
            #drawButton {
                width: 90%;
                font-size: 1.1rem;
                padding: 12px 25px;
            }
            
            #rarityMessage {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            :root {
                --gif-width: 300px;
                --gif-height: 225px;
            }
            
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px 25px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            #currentNumber {
                font-size: 5rem;
            }
            
            #drawButton {
                width: 100%;
                font-size: 1rem;
                padding: 10px 20px;
            }
            
            #drawnNumbers span {
                padding: 6px 12px;
                font-size: 1rem;
            }
            
            #rarityMessage {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 360px) {
            :root {
                --gif-width: 280px;
                --gif-height: 210px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            #currentNumber {
                font-size: 4rem;
            }
            
            .container {
                padding: 15px 20px;
            }
        }
    </style>
</head>

<body>
    <div id="particleContainer"></div>
    
    <!-- GIFÁâπÊïàÂÆπÂô® -->
    <div class="gif-overlay" id="gifOverlay">
        <div class="gif-container">
            <img id="gifImage" src="" alt="ÁâπÊïàGIF">
        </div>
    </div>

    <div class="container">
        <h1>üé≤ Âπ∏ÈÅãÊäΩÂèñÔºàÂÑ™ÂåñÁâàÔºâ</h1>
        
        <button id="drawButton" aria-label="ÈñãÂßãÈö®Ê©üÊäΩÂèñÊï∏Â≠ó">ÈñãÂßãÊäΩÂèñ</button>
        
        <div id="resultArea" role="status" aria-live="polite">
            <div id="rarityMessage"></div>
            <div id="currentNumber"></div>
            <div id="drawnNumbers"></div>
            <div id="statusMessage">ÈªûÊìäÊåâÈàïÈñãÂßãÊäΩÂèñÊï∏Â≠ó (1-22)</div>
        </div>
        
        <button id="resetButton" aria-label="ÈáçÁΩÆÊäΩÂèñÁ≥ªÁµ±">ÈáçÊñ∞ÈñãÂßã</button>
    </div>

    <script>
        // ÈÖçÁΩÆÂ∞çË±°
        const CONFIG = {
            totalNumbers: 22,
            animationDuration: {
                common: 800,
                legendary: 3000
            },
            particleSettings: {
                common: { count: 50, duration: 2 },
                uncommon: { count: 75, duration: 2 },
                rare: { count: 100, duration: 2 },
                epic: { count: 150, duration: 2.5 },
                legendary: { count: 200, duration: 3 }
            },
            gifDuration: 2500 // GIFÊí≠ÊîæÊåÅÁª≠Êó∂Èó¥
        };

        // ÊáâÁî®ÁãÄÊÖã
        const AppState = {
            IDLE: 'idle',
            DRAWING: 'drawing',
            SHOWING_GIF: 'showing_gif',
            COMPLETED: 'completed'
        };

        // Á®ÄÊúâÂ∫¶ÈÖçÁΩÆ
        const RARITIES = new Map([
            ['common', { name: 'ÊôÆÈÄö', color: '#ffffff', probability: 0.45, class: 'common', particleColor: 'rgba(255, 255, 255, 0.7)' }],
            ['uncommon', { name: 'ÁΩïË¶ã', color: '#90ee90', probability: 0.3, class: 'uncommon', particleColor: 'rgba(50, 205, 50, 0.7)' }],
            ['rare', { name: 'Á®ÄÊúâ', color: '#add8e6', probability: 0.15, class: 'rare', particleColor: 'rgba(51, 153, 255, 0.7)' }],
            ['epic', { name: 'Âè≤Ë©©', color: '#d8bfd8', probability: 0.07, class: 'epic', particleColor: 'rgba(153, 102, 255, 0.7)' }],
            ['legendary', { name: 'ÂÇ≥Â•á', color: '#f0e68c', probability: 0.03, class: 'legendary', particleColor: 'rgba(255, 215, 0, 0.7)' }]
        ]);

        // Êï∏Â≠óÊèèËø∞ÈÖçÁΩÆÔºàÁßªÈô§ÊâÄÊúâemojiÔºâ
        const NUMBER_DESCRIPTIONS = new Map([
            [1, { message: 'ÊÅ≠ÂñúÁç≤Âæó"ÂÆ∂ÈáåÊúâ‰∫ã"1ËôüÔºÅ‰ªäÂ§©‰∏çÁî®‰∏äÂ≠∏Âï¶ÔºÅ', color: '#87CEFA' }],
            [2, { message: 'ÊÅ≠ÂñúÁç≤Âæó2ËôüÔºÅÂ§ßÊ®πÂú®È¢®‰∏≠ÁòãÁãÇÂú∞Áî©È†≠È´ÆÔºÅ', color: '#90EE90' }],
            [3, { message: 'ÊÅ≠ÂñúÁç≤Âæó3ËôüÔºÅÁî®ÊâãÂêÉÈ£ØÔºåÂ∞±ÊòØÈ¶ôÔºÅ', color: '#FFFFFF' }],
            [4, { message: 'Á±≥Â•áÂ¶ôÂ¶ôÂ±ãÔºåÈñãÂïüÔºÅÊÅ≠ÂñúÁç≤ÂæóÁ•ûÂ•áÁöÑ4ËôüÔºÅ', color: 'yellow', font: "'Comic Sans MS', sans-serif" }],
            [5, { message: 'ÊÅ≠ÂñúÁç≤Âæó5ËôüÔºÅË®ò‰ΩèÔºö‰∏çËÆÄÊõ∏Â∞±ÊúÉËÆäÂ§™Áõ£ÔºÅ', color: '#FF69B4' }],
            [6, { message: 'ÊÅ≠ÂñúÁç≤Âæó6ËôüÔºÅÊ≤âÈªòÊòØÈáëÔºå‰ªÄÈ∫ºÈÉΩ‰∏çË™™...', color: '#87CEFA' }],
            [7, { message: 'ÊÅ≠ÂñúÁç≤Âæó7ËôüÔºÅÁ©∫ÊâãÈÅìÈ´òÊâãÂú®Ê≠§ÔºÅ', color: '#FFD700' }],
            [8, { message: 'ÊÅ≠ÂñúÁç≤ÂæóÂ≠´ÊÇüÁ©∫8ËôüÔºÅ', color: '#FFD700' }],
            [9, { message: 'ÊÅ≠ÂñúÁç≤ÂæóÁ´ôÂú®Ê®π‰∏äÁöÑ9ËôüÔºÅ', color: '#90EE90' }],
            [10, { message: 'ÊÅ≠ÂñúÁç≤Âæó10ËôüÔºÅÊï∏Êï∏ÊúÉÊï∏Êºè‰∏ÄÂÄãÂì¶~', color: '#87CEFA' }],
            [11, { message: 'ÊÅ≠ÂñúÁç≤ÂæóÊ∞¥‰∏äÊªëË°åÁöÑ11ËôüÔºÅ', color: '#87CEFA' }],
            [12, { message: 'ÊÅ≠ÂñúÁç≤Âæó12ËôüÔºÅËúúËúÇ"Âï§Âï§"Âè´~', color: '#FFD700' }],
            [13, { message: 'ÊÅ≠ÂñúÁç≤ÂæóÈáëÈ≠öË®òÊÜ∂13Ëôü...ÊàëÂâõÊâçË¶ÅË™™‰ªÄÈ∫º‰æÜÁùÄÔºü', color: '#FFD700' }],
            [14, { message: 'ÊÅ≠ÂñúÁç≤Âæó14ËôüÔºÅ‰ΩúÊñáÂêàÊ†ºÔºÅ', color: '#FFD700' }],
            [15, { message: 'ÊÅ≠ÂñúÁç≤Âæó15ËôüÔºÅ‰∏ÄËµ∑ËÆÄ„ÄäÈ≠îÈÅìÁ•ñÂ∏´„ÄãÂêßÔºÅ', color: '#FF69B4' }],
            [16, { message: 'ÊÅ≠ÂñúÁç≤Âæó16ËôüÔºÅË∑≥ÈÅ†10Á±≥ÔºåÊâìÁ†¥‰∏ñÁïåÁ¥ÄÈåÑÔºÅ', color: '#FFA500' }],
            [17, { message: 'ÊÅ≠ÂñúÁç≤ÂæóÁàÜÁÇ∏Â†ÖÊûú17ËôüÔºÅBOOMÔºÅ', color: '#FF4500' }],
            [18, { message: 'ÊÅ≠ÂñúÁç≤Âæó18ËôüÔºÅÂäüË™≤Ë¢´Ë≤ìÂêÉÊéâ‰∫ÜÔºÅ', color: '#DEB887' }],
            [19, { message: 'ÊÅ≠ÂñúÁç≤Âæó19ËôüÔºÅ‰ªäÂ§©Ë´ãÂ§ßÂÆ∂ÂêÉÈõûÁøÖÔºÅ', color: '#FF69B4' }],
            [20, { message: 'ÊÅ≠ÂñúÁç≤Âæó20ËôüÔºÅÁúüÁõ∏Âè™Êúâ‰∏ÄÂÄãÔºÅÊàëÊòØÈ´ò‰∏≠ÁîüÂÅµÊé¢‚Äî‚ÄîÂ∑•Ëó§ÂøÉ‰∏ÄÔºÅ', color: '#FFFFFF' }], // ÊîπÁÇ∫ÁôΩËâ≤ÔºåÊèêÈ´òÂ∞çÊØîÂ∫¶
            [21, { message: 'ÊÅ≠ÂñúÁç≤Âæó21ËôüÔºÅÊúâÈè°È†≠Â∞±ÊúÉÊúõÂêëÈÇ£ÂÄãÊñπÂêë~', color: '#87CEFA' }],
            [22, { message: 'ÊÅ≠ÂñúÁç≤Âæó22ËôüÔºÅ‰ªäÂ§©Ëº™Âà∞‰Ω†Ê∏ÖÊ¥óÈ¶¨Ê°∂‰∫ÜÔºÅ', color: '#E0FFFF' }]
        ]);

        // Êï∏Â≠óÊäΩÂèñÁ≥ªÁµ±È°û
        class NumberDrawSystem {
            constructor() {
                this.availableNumbers = [];
                this.drawnNumbers = [];
                this.rarityData = new Map();
                this.currentState = AppState.IDLE;
                this.animationFrameId = null;
                
                this.drawButton = document.getElementById('drawButton');
                this.resetButton = document.getElementById('resetButton');
                this.currentNumber = document.getElementById('currentNumber');
                this.drawnNumbersElement = document.getElementById('drawnNumbers');
                this.statusMessage = document.getElementById('statusMessage');
                this.rarityMessage = document.getElementById('rarityMessage');
                this.particleContainer = document.getElementById('particleContainer');
                this.gifOverlay = document.getElementById('gifOverlay');
                this.gifImage = document.getElementById('gifImage');
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.initializeNumbers();
                this.assignRarities();
                
                // È†ÅÈù¢Âä†ËºâÂãïÁï´
                this.currentNumber.style.opacity = '0';
                setTimeout(() => {
                    this.currentNumber.style.opacity = '1';
                }, 500);
            }
            
            setupEventListeners() {
                this.drawButton.addEventListener('click', () => {
                    this.handleDraw();
                });
                
                this.resetButton.addEventListener('click', () => {
                    this.resetSystem();
                });
                
                // GIFÈªûÊìäÈóúÈñâ
                this.gifOverlay.addEventListener('click', () => {
                    this.hideGif();
                });
                
                // ÈçµÁõ§Âø´Êç∑ÈçµÊîØÊåÅ
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        if (this.currentState === AppState.IDLE) {
                            this.handleDraw();
                        }
                    } else if (e.key === 'r' || e.key === 'R') {
                        this.resetSystem();
                    } else if (e.key === 'Escape') {
                        this.hideGif();
                    }
                });
                
                // Ê∏ÖÁêÜÁ≤íÂ≠êÊïàÊûú
                setInterval(() => {
                    this.cleanupParticles();
                }, 5000);
            }
            
            initializeNumbers() {
                this.availableNumbers = Array.from({ length: CONFIG.totalNumbers }, (_, i) => i + 1);
                this.drawnNumbers = [];
                this.updateStatusMessage();
            }
            
            assignRarities() {
                this.rarityData.clear();
                
                this.availableNumbers.forEach(number => {
                    let random = Math.random();
                    
                    let cumulativeProbability = 0;
                    let assignedRarity = 'common';
                    
                    for (const [rarity, config] of RARITIES) {
                        cumulativeProbability += config.probability;
                        if (random < cumulativeProbability) {
                            assignedRarity = rarity;
                            break;
                        }
                    }
                    
                    this.rarityData.set(number, assignedRarity);
                });
            }
            
            async handleDraw() {
                if (this.availableNumbers.length === 0 || this.currentState !== AppState.IDLE) {
                    return;
                }
                
                this.currentState = AppState.DRAWING;
                this.drawButton.disabled = true;
                this.drawButton.textContent = 'ÊäΩÂèñ‰∏≠...';
                this.statusMessage.textContent = 'Ê≠£Âú®ÊäΩÂèñÔºåË´ãÁ®çÂÄô...';
                this.rarityMessage.textContent = '';
                this.currentNumber.style.opacity = '0.7';
                
                try {
                    await this.drawAnimation();
                    
                    const randomIndex = Math.floor(Math.random() * this.availableNumbers.length);
                    const number = this.availableNumbers[randomIndex];
                    const rarity = this.rarityData.get(number);
                    
                    // È°ØÁ§∫Êï∏Â≠ó
                    this.currentNumber.textContent = number;
                    this.currentNumber.style.color = RARITIES.get(rarity).color;
                    this.currentNumber.style.transform = 'scale(1.2)';
                    this.currentNumber.classList.add('number-appear');
                    
                    // È°ØÁ§∫ÊèèËø∞‰ø°ÊÅØ
                    this.showRarityMessage(number, rarity);
                    
                    // Ê∑ªÂä†Á≤íÂ≠êÊïàÊûú
                    this.createParticles(rarity);
                    
                    // Êí≠ÊîæGIFÁâπÊïà
                    await this.playGifEffect(number);
                    
                    // Êõ¥Êñ∞Â∑≤ÊäΩÂèñÊï∏Â≠óÂàóË°®
                    this.drawnNumbers.push(number);
                    this.availableNumbers.splice(randomIndex, 1);
                    this.updateDrawnNumbersDisplay();
                    
                    // Êõ¥Êñ∞ÁãÄÊÖã
                    this.updateStatusMessage();
                    
                    setTimeout(() => {
                        this.currentNumber.style.transform = 'scale(1)';
                        this.currentNumber.classList.remove('number-appear');
                    }, 800);
                    
                    // Ê™¢Êü•ÊòØÂê¶ÂÆåÊàê
                    if (this.availableNumbers.length === 0) {
                        this.currentState = AppState.COMPLETED;
                        setTimeout(() => {
                            alert('ÊÅ≠ÂñúÔºÅÊâÄÊúâÊï∏Â≠óÂ∑≤ÊäΩÂèñÂÆåÁï¢ÔºÅ');
                        }, 500);
                    } else {
                        this.currentState = AppState.IDLE;
                    }
                    
                } catch (error) {
                    console.error('ÊäΩÂèñÈÅéÁ®ã‰∏≠ÁôºÁîüÈåØË™§:', error);
                    this.statusMessage.textContent = 'ÊäΩÂèñÂ§±ÊïóÔºåË´ãÈáçË©¶';
                } finally {
                    this.drawButton.disabled = this.availableNumbers.length === 0;
                    this.drawButton.textContent = this.availableNumbers.length > 0 ? 'ÁπºÁ∫åÊäΩÂèñ' : 'ÊäΩÂèñÂÆåÁï¢';
                }
            }
            
            drawAnimation() {
                return new Promise(resolve => {
                    let counter = 0;
                    const maxCounter = 20;
                    
                    const animate = () => {
                        if (counter >= maxCounter) {
                            resolve();
                            return;
                        }
                        
                        const randomIndex = Math.floor(Math.random() * this.availableNumbers.length);
                        const tempNumber = this.availableNumbers[randomIndex];
                        const tempRarity = this.rarityData.get(tempNumber);
                        
                        this.currentNumber.textContent = tempNumber;
                        this.currentNumber.style.color = RARITIES.get(tempRarity).color;
                        this.currentNumber.style.transform = `scale(${1 + Math.sin(counter * 0.2) * 0.1})`;
                        
                        counter++;
                        this.animationFrameId = requestAnimationFrame(animate);
                    };
                    
                    this.animationFrameId = requestAnimationFrame(animate);
                });
            }
            
            // Êí≠ÊîæGIFÁâπÊïà
            playGifEffect(number) {
                return new Promise(resolve => {
                    // Ë®≠ÁΩÆGIFË∑ØÂæë - Êõ¥Êñ∞ÁÇ∫ images/6e1.gif Ê†ºÂºè
                    const gifPath = `images/6e${number}.gif`;
                    this.gifImage.src = gifPath;
                    
                    // È°ØÁ§∫GIFÂÆπÂô®
                    this.gifOverlay.classList.add('active');
                    this.currentState = AppState.SHOWING_GIF;
                    
                    // Ë®≠ÁΩÆË∂ÖÊôÇËá™ÂãïÈóúÈñâ
                    setTimeout(() => {
                        this.hideGif();
                        resolve();
                    }, CONFIG.gifDuration);
                });
            }
            
            hideGif() {
                this.gifOverlay.classList.remove('active');
                this.gifImage.src = '';
                if (this.currentState === AppState.SHOWING_GIF) {
                    this.currentState = AppState.IDLE;
                }
            }
            
            showRarityMessage(number, rarity) {
                let messageHTML;
                
                if (NUMBER_DESCRIPTIONS.has(number)) {
                    const description = NUMBER_DESCRIPTIONS.get(number);
                    messageHTML = `<span style="color: ${description.color}; text-shadow: 0 0 10px ${description.color}; ${description.font ? `font-family: ${description.font};` : ''}">${description.message}</span>`;
                } else {
                    const rarityConfig = RARITIES.get(rarity);
                    messageHTML = `<span style="color: ${rarityConfig.color};">ÊÅ≠ÂñúÔºÅÁç≤Âæó${rarityConfig.name}Êï∏Â≠óÔºÅ</span>`;
                }
                
                this.rarityMessage.innerHTML = messageHTML;
            }
            
            createParticles(rarity) {
                const rarityConfig = RARITIES.get(rarity);
                const particleSettings = CONFIG.particleSettings[rarity] || CONFIG.particleSettings.common;
                
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                for (let i = 0; i < particleSettings.count; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    const size = Math.random() * 10 + 5;
                    particle.style.width = particle.style.height = `${size}px`;
                    particle.style.backgroundColor = rarityConfig.particleColor;
                    particle.style.left = `${centerX}px`;
                    particle.style.top = `${centerY}px`;
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * 150 + 50;
                    const targetX = centerX + Math.cos(angle) * distance;
                    const targetY = centerY + Math.sin(angle) * distance;
                    
                    this.particleContainer.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.style.transition = `all ${Math.random() * 1 + 0.5}s ease-out`;
                        particle.style.left = `${targetX}px`;
                        particle.style.top = `${targetY}px`;
                        particle.style.opacity = '0';
                    }, 10);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, particleSettings.duration * 1000);
                }
            }
            
            updateDrawnNumbersDisplay() {
                this.drawnNumbersElement.innerHTML = '';
                
                // ÊåâÁ®ÄÊúâÂ∫¶ÊéíÂ∫è
                const sortedNumbers = [...this.drawnNumbers].sort((a, b) => {
                    const rarityOrder = { legendary: 5, epic: 4, rare: 3, uncommon: 2, common: 1 };
                    return rarityOrder[this.rarityData.get(b)] - rarityOrder[this.rarityData.get(a)];
                });
                
                sortedNumbers.forEach(num => {
                    const rarity = this.rarityData.get(num);
                    const rarityConfig = RARITIES.get(rarity);
                    
                    const span = document.createElement('span');
                    span.textContent = num;
                    span.classList.add(rarityConfig.class);
                    
                    // Ê∑ªÂä†Á®ÄÊúâÂ∫¶Ê®ôÁ±§
                    if (rarity !== 'common' && rarity !== 'uncommon') {
                        const tag = document.createElement('span');
                        tag.classList.add('rarity-tag');
                        tag.textContent = rarityConfig.name.substring(0, 2);
                        span.appendChild(tag);
                    }
                    
                    // ÁâπÊÆäÊï∏Â≠óÊ®£Âºè
                    if (NUMBER_DESCRIPTIONS.has(num)) {
                        span.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.4)';
                        span.style.borderColor = 'rgba(255, 215, 0, 0.6)';
                    }
                    
                    span.style.opacity = '0';
                    span.style.transform = 'translateY(10px)';
                    this.drawnNumbersElement.appendChild(span);
                    
                    setTimeout(() => {
                        span.style.opacity = '1';
                        span.style.transform = 'translateY(0)';
                    }, 50);
                });
            }
            
            updateStatusMessage() {
                this.statusMessage.textContent = `Â∑≤ÊäΩÂèñ ${this.drawnNumbers.length} ÂÄãÊï∏Â≠óÔºåÂâ©È§ò ${this.availableNumbers.length} ÂÄã`;
            }
            
            resetSystem() {
                // ÂèñÊ∂àÂãïÁï´ÂπÄ
                if (this.animationFrameId) {
                    cancelAnimationFrame(this.animationFrameId);
                }
                
                // Èö±ËóèGIF
                this.hideGif();
                
                // ÈáçÁΩÆÁãÄÊÖã
                this.currentState = AppState.IDLE;
                this.currentNumber.textContent = '';
                this.rarityMessage.textContent = '';
                
                // ÈáçÊñ∞ÂàùÂßãÂåñ
                this.initializeNumbers();
                this.assignRarities();
                this.updateDrawnNumbersDisplay();
                
                this.drawButton.disabled = false;
                this.drawButton.textContent = 'ÈñãÂßãÊäΩÂèñ';
                this.statusMessage.textContent = 'ÈªûÊìäÊåâÈàïÈñãÂßãÊäΩÂèñÊï∏Â≠ó (1-22)';
                
                // Ê∏ÖÁêÜÁ≤íÂ≠ê
                this.particleContainer.innerHTML = '';
            }
            
            cleanupParticles() {
                const particles = document.querySelectorAll('.particle');
                particles.forEach(particle => {
                    if (!particle.isConnected || parseFloat(particle.style.opacity) === 0) {
                        particle.remove();
                    }
                });
            }
        }

        // ÂàùÂßãÂåñÊáâÁî®
        document.addEventListener('DOMContentLoaded', () => {
            // È†êÂä†ËºâGIFË≥áÊ∫ê
            const preloadGifs = () => {
                const gifUrls = [];
                for (let i = 1; i <= 22; i++) {
                    gifUrls.push(`images/6e${i}.gif`);
                }
                
                // È†êÂä†ËºâÊâÄÊúâGIF
                gifUrls.forEach(url => {
                    const img = new Image();
                    img.src = url;
                });
            };
            
            preloadGifs();
            
            // ÂâµÂª∫Êï∏Â≠óÊäΩÂèñÁ≥ªÁµ±ÂØ¶‰æã
            const numberDrawSystem = new NumberDrawSystem();
        });
    </script>
</body>
</html>
